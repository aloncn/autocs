<!DOCTYPE html>
{{ define "web/index.html" }}
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>{{ .title }}</title>
    <link rel="stylesheet" href="/assets/layui/css/layui.css">
</head>
<body>

<!-- ä½ çš„HTMLä»£ç  -->

<script src="/assets/layui/layui.js"></script>
<script>

    layui.use('layim', function(layim){
        var layim = layui.layim;
        var mine =  {
            "username": "æˆ‘" //æˆ‘çš„æ˜µç§°
            ,"id": "1001" //æˆ‘çš„ID
            ,"status": "online" //åœ¨çº¿çŠ¶æ€ onlineï¼šåœ¨çº¿ã€hideï¼šéšèº«
            ,"remark": "åœ¨æ·±é‚ƒçš„ç¼–ç ä¸–ç•Œï¼Œåšä¸€æšè½»ç›ˆçš„çº¸é£æœº" //æˆ‘çš„ç­¾å
            ,"avatar": "/assets/img/profile-photos/1.png" //æˆ‘çš„å¤´åƒ
        }//é…ç½®å®¢æˆ·ä¿¡æ¯
        layim.config({
            init: {
                //é…ç½®å®¢æˆ·ä¿¡æ¯
                mine:mine
            },
            brief: true ,//æ˜¯å¦ç®€çº¦æ¨¡å¼ï¼ˆå¦‚æœtrueåˆ™ä¸æ˜¾ç¤ºä¸»é¢æ¿ï¼‰
        });

        layim.chat({
            name: 'å®¢æœå§å§'
            ,type: 'friend'
            ,avatar: '/assets/img/profile-photos/8.png'
            ,id: "1000"
        });

        //å»ºç«‹WebSocketé€šè®¯
        //æ³¨æ„ï¼šå¦‚æœä½ è¦å…¼å®¹ie8+ï¼Œå»ºè®®ä½ é‡‡ç”¨ socket.io çš„ç‰ˆæœ¬ã€‚ä¸‹é¢æ˜¯ä»¥åŸç”ŸWSä¸ºä¾‹
        var socket = new WebSocket('ws://127.0.0.1:8000/chat_demo');
        //è¿æ¥æˆåŠŸæ—¶è§¦å‘
        socket.onopen = function(){
            //socket.send('è¿æ¥æˆåŠŸ');
        };

        layim.on('sendMessage', function(data){
          //console.log(res)
            socket.send(JSON.stringify({
                type: 'sendMessage' //éšä¾¿å®šä¹‰ï¼Œç”¨äºåœ¨æœåŠ¡ç«¯åŒºåˆ†æ¶ˆæ¯ç±»å‹
                ,data: data
            }));

        });
        //ç›‘å¬æ”¶åˆ°çš„æ¶ˆæ¯
        socket.onmessage = function(res){
           var To = JSON.parse(res.data);
            console.log(To);
            if(To.type === 'friend'){
                layim.setChatStatus('<span style="color:#FF5722;">ğŸ¤– æ•°æ®æ£€ç´¢ä¸­...</span>');
            }

            var obj = {};
            obj = {
                username: To.username
                ,avatar: To.avatar
                ,id: To.id
                ,type: To.type
                ,content: To.content
            }
            layim.setChatStatus('<span style="color:#FF5722;">ğŸ¼ 7x24å°æ—¶åœ¨çº¿ï¼ï¼ï¼</span>');
            layim.getMessage(obj);

        };
    });
</script>

</body>
</html>
{{ end }}